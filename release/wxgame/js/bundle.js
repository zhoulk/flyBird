!function(){"use strict";class e extends Laya.Script{constructor(){super(),this.xx=null}onAwake(){if(console.log("hello"),Laya.Browser.onMiniGame){console.log("get Device "),wx.onBluetoothAdapterStateChange(function(e){console.log("adapterState changed, now is",e)});var e=this;wx.onBluetoothDeviceFound(function(a){console.log("发现设备:",a.devices),e.scanDevices(a.devices)}),wx.openBluetoothAdapter({success(e){console.log(e),wx.startBluetoothDevicesDiscovery({success(e){console.log(e)},fail:function(e){console.log("fail"+JSON.stringify(e))}})}})}}scanDevices(e){for(let t=0;t<e.length;t++)if("Odun_Pen"==e[t].name){wx.stopBluetoothDevicesDiscovery({success:function(e){}}),console.log("已找到指定设备:",e[t].deviceId);var a=e[t].deviceId;this.connectDevice(a)}}connectDevice(e){var a=this;wx.createBLEConnection({deviceId:e,success:function(t){console.log("连接蓝牙:",t.errMsg),a.searchServices(e)},fail:function(e){app.showToast("连接超时,请重试或更换车辆","none"),wx.closeBluetoothAdapter()}})}searchServices(e){var a=this;wx.getBLEDeviceServices({deviceId:e,success:function(t){let s="";for(let e=0;e<t.services.length;e++)if(-1!=t.services[e].uuid.toUpperCase().indexOf("AA00")){s=t.services[e].uuid;break}console.log("fee7-service_id:",s),a.searchCharaters(e,s)},fail(e){console.log(e)}})}searchCharaters(e,a){wx.getBLEDeviceCharacteristics({deviceId:e,serviceId:a,success:function(t){console.log("device特征值:",t.characteristics);var s=t.characteristics;for(let n=0;n<t.characteristics.length;n++){let i=t.characteristics[n];i.properties.notify&&(console.log("indicate_id:",i.uuid),wx.notifyBLECharacteristicValueChange({state:!0,deviceId:e,serviceId:a,characteristicId:i.uuid,success:function(t){console.log("开启notify",t.errMsg),wx.onBLECharacteristicValueChange(function(e){console.log("特征值变化",e.value),Laya.stage.event("Di")});for(let t=0;t<s.length;t++){let c=s[t];if(c.properties.write){console.log("写write_id:",c.uuid);var n="a50006020900585f",i=new ArrayBuffer(n.length);let t=new DataView(i),s=0;for(var o=0,r=n.length;o<r;o+=2){let e=parseInt(n.substr(o,2),16);t.setUint8(s,e),s++}wx.writeBLECharacteristicValue({deviceId:e,serviceId:a,characteristicId:c.uuid,value:i,success:function(e){console.log("发送数据:",e.errMsg)}})}}}}))}}})}ab2hex(e){return Array.prototype.map.call(new Uint8Array(e),function(e){return("00"+e.toString(16)).slice(-2)}).join("")}}class a extends Laya.Script{constructor(){super(),this.xx=null}onAwake(){this.owner.getComponent(Laya.RigidBody).linearVelocity={x:-3,y:0},Laya.stage.on("Again",this,()=>{this.owner.getComponent(Laya.RigidBody).linearVelocity={x:-3,y:0}})}onUpdate(){GameData.isGameOver&&(this.owner.getComponent(Laya.RigidBody).linearVelocity={x:0,y:0})}}let t;class s extends Laya.Script{constructor(){super(),this.xx=null}onAwake(){t=this.owner.width}onUpdate(){this.owner.x<=-t&&(console.log(this.owner.name+"  "+this.owner.x+"  "+t),this.owner.x+=2*t)}}class n extends Laya.Script{constructor(){super(),this.force=null}onAwake(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),Laya.stage.on("Again",this,this.againGame),this.owner.getComponent(Laya.RigidBody).type="static",Laya.stage.on("Di",this,this.onMouseDown)}onMouseDown(){0!=GameData.isGaming&&(this.owner.getComponent(Laya.RigidBody).linearVelocity={x:0,y:this.force},this.owner.autoAnimation="Fly",this.owner.loop=!1,Laya.SoundManager.playSound("audio/fly.mp3"))}againGame(){this.owner.autoAnimation="Idle",this.owner.rotation=0,this.owner.pos(122,132),GameData.isGameOver=!1,GameData.isGaming=!0}onUpdate(){GameData.isGaming&&(this.owner.getComponent(Laya.RigidBody).type="dynamic"),0==this.owner.isPlaying&&(this.owner.autoAnimation="Idle")}onTriggerEnter(e){if("top"==e.owner.name)return;this.owner.autoAnimation="Die",GameData.isGameOver=!0,GameData.isGaming=!1;let a=Number(Laya.LocalStorage.getItem("Score"));GameData.score>a&&Laya.LocalStorage.setItem("Score",GameData.score),Laya.SoundManager.playSound("audio/hit.mp3")}}class i extends Laya.Script{constructor(){super(),this.canAddScore=!0}onAwake(){}onUpdate(){if(this.owner.x<=-300)return this.owner.removeSelf(),void Laya.Pool.recover("Column",this.owner);this.canAddScore&&this.owner.x<=-130&&(this.canAddScore=!1,console.log("增加分数"),GameData.score++,Laya.SoundManager.playSound("audio/score.mp3"))}}window.GameData||(window.GameData={isIdle:!0,isGaming:!1,isGameOver:!1,score:0});let o,r,c=2e3,l=0,h=[];class d extends Laya.Script{constructor(){super(),this.columnPrefab=null}onAwake(){o=this.owner.getChildByName("ColumnParent"),Laya.stage.on("Again",this,()=>{h.forEach(e=>{e.removeSelf()})})}onUpdate(){0!=GameData.isGaming?(l+=Laya.timer.delta)>=c&&(l=0,c=this.getRandom(4e3,5e3),this.spawn()):l=0}spawn(){var e=Laya.Pool.getItemByCreateFun("Column",this.createFunc,this);o.addChild(e),e.rotation=0;let a=this.getRandom(300,600);e.pos(920,a),e.getComponent(i).canAddScore=!0,h.push(e);let t=a-this.getRandom(245,348);var s=Laya.Pool.getItemByCreateFun("Column",this.createFunc,this);o.addChild(s),s.rotation=180,s.pos(1160,t),s.getComponent(i).canAddScore=!1,h.push(s)}createFunc(){return this.columnPrefab.create()}getRandom(e,a){return e+Math.random()*(a-e)}}class u extends Laya.Script{static Instance(){return r}constructor(){super(),this.scoreTxt=null,this.startTxt=null,this.failPanel=null,this.rankPanel=null,this.rankScore=null,r=this}onAwake(){if(this.failPanel.visible=!1,this.rankPanel.visible=!1,this.scoreTxt.visible=!1,Laya.stage.on(Laya.Event.CLICK,this,this.OnStartClick),Laya.Browser.onMiniGame){var e=this;wx.getSystemInfo({success:function(a){console.log(a.model),-1!=a.model.search("iPhone X")&&e.scoreTxt.pos(0,75)}})}}onUpdate(){this.scoreTxt.text="Score:"+GameData.score,GameData.isGameOver&&(this.scoreTxt.visible=!1,0==this.failPanel.visible&&(this.failPanel.visible=!0,Laya.Tween.from(this.failPanel,{alpha:0},500,Laya.Ease.linearIn)))}OnStartClick(){GameData.isIdle&&(this.scoreTxt.visible=!0,this.startTxt.visible=!1,GameData.isIdle=!1,GameData.isGaming=!0)}againGame(){GameData.score=0,GameData.isGameOver=!1,this.scoreTxt.visible=!0,this.failPanel.visible=!1}showRank(){let e=Laya.LocalStorage.getItem("Score");null==e&&(e="0"),this.rankScore.text="最高分:"+e,this.rankPanel.visible=!0,this.rankPanel.show()}}class g extends Laya.Script{constructor(){super(),this.rankBtn=null,this.againBtn=null}onAwake(){this.rankBtn.on(Laya.Event.CLICK,this,this.OnRankClick),this.againBtn.on(Laya.Event.CLICK,this,this.OnAgainClick)}OnRankClick(){u.Instance().showRank()}OnAgainClick(){u.Instance().againGame(),Laya.stage.event("Again")}}class y{static init(){let t=Laya.ClassUtils.regClass;t("scripts/main.js",e),t("scripts/AutoMove.js",a),t("scripts/RepeatingBg.js",s),t("scripts/BirdCtrl.js",n),t("scripts/ColumnSpawn.js",d),t("scripts/UICtrl.js",u),t("scripts/FailPanel.js",g),t("scripts/Column.js",i)}}y.width=720,y.height=1280,y.scaleMode="showall",y.screenMode="none",y.alignV="middle",y.alignH="center",y.startScene="main.scene",y.sceneRoot="",y.debug=!1,y.stat=!1,y.physicsDebug=!1,y.exportSceneToJson=!0,y.init();new class{constructor(){window.Laya3D?Laya3D.init(y.width,y.height):Laya.init(y.width,y.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=y.scaleMode,Laya.stage.screenMode=y.screenMode,Laya.stage.alignV=y.alignV,Laya.stage.alignH=y.alignH,Laya.URL.exportSceneToJson=y.exportSceneToJson,(y.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),y.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),y.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){y.startScene&&Laya.Scene.open(y.startScene)}}}();